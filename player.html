<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gift Player â€” Huggnote2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script defer src="assets/js/main.js"></script>
  </head>
  <body>
    <div class="player-hero">
      <div class="snow" aria-hidden="true"></div>
      <div>
        <p class="pill" id="player-pill">For You Â· From Huggnote</p>
        <h1 id="player-hero-title">Open your holiday surprise</h1>
        <p class="section-subtitle">Tap the gift box â€” hearts will float out and your custom song will begin.</p>
        <div class="gift" data-gift aria-label="Open gift">
          <span>ğŸ</span>
          <div class="hearts" data-hearts></div>
        </div>
        <div class="player-card" data-player-card style="display: none">
          <h2 id="player-title">Your Song Title</h2>
          <p class="muted" id="player-subtitle">A custom song crafted just for you.</p>
          <audio controls id="player-audio" src=""></audio>
          <div class="copy-box" style="margin-top: 12px">
            <input id="player-link" value="" readonly />
            <button class="btn btn-secondary" type="button" data-copy="#player-link">Copy link</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        
        const title = params.get('title');
        const recipient = params.get('recipient');
        const vibe = params.get('vibe');
        const audioUrl = params.get('audio');
        
        const playerTitle = document.getElementById('player-title');
        const playerPill = document.getElementById('player-pill');
        const playerSubtitle = document.getElementById('player-subtitle');
        const playerAudio = document.getElementById('player-audio');
        const playerLink = document.getElementById('player-link');

        if (title) playerTitle.textContent = title;
        if (recipient) playerPill.textContent = `For ${recipient}`;
        if (vibe) playerSubtitle.textContent = `A ${vibe} song crafted just for you.`;
        
        if (audioUrl && audioUrl !== 'undefined' && audioUrl !== 'null') {
            playerAudio.src = audioUrl;
            // Attempt to autoplay
            playerAudio.play().catch(e => console.log("Autoplay prevented:", e));
        } else {
            // Handle missing audio
            playerAudio.style.display = 'none';
            const errorMsg = document.createElement('p');
            errorMsg.className = 'error';
            errorMsg.style.textAlign = 'center';
            errorMsg.textContent = "Song file is missing or invalid.";
            playerAudio.parentElement.insertBefore(errorMsg, playerAudio);
        }
        
        playerLink.value = window.location.href;

        // Automatically trigger the gift interaction visually after a short delay
        // but keep audio playing from the above direct play call
        const gift = document.querySelector("[data-gift]");
        const hearts = document.querySelector("[data-hearts]");
        const playerCard = document.querySelector("[data-player-card]");

        if (gift && hearts && playerCard) {
            setTimeout(() => {
                hearts.innerHTML = "";
                for (let i = 0; i < 14; i++) {
                    const h = document.createElement("div");
                    h.className = "heart";
                    h.style.left = `${20 + Math.random() * 60}%`;
                    h.style.animationDelay = `${Math.random() * 0.6}s`;
                    hearts.appendChild(h);
                }
                hearts.style.opacity = "1";
                setTimeout(() => (hearts.style.opacity = "0"), 2000);
                playerCard.style.display = "block";
            }, 1000); // 1 second delay to allow initial DOM render
        }
      });
    </script>
  </body>
</html>
